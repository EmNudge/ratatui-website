<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Multiple Functions - Ratatui Book</title>


        <!-- Custom HTML head -->
        <script type="module">
          import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
          mermaid.initialize({ startOnLoad: true });
        </script>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../.././mdbook-admonish.css">
        <link rel="stylesheet" href="../.././theme/catppuccin.css">
        <link rel="stylesheet" href="../.././theme/catppuccin-highlight.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../index.html">Home</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="../../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Tutorials</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorial/hello-world/index.html"><strong aria-hidden="true">2.1.</strong> Hello World</a></li><li class="chapter-item expanded "><a href="../../tutorial/counter-app/index.html"><strong aria-hidden="true">2.2.</strong> Counter App</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorial/counter-app/single-function.html"><strong aria-hidden="true">2.2.1.</strong> Single Function</a></li><li class="chapter-item expanded "><a href="../../tutorial/counter-app/refactor.html" class="active"><strong aria-hidden="true">2.2.2.</strong> Multiple Functions</a></li><li class="chapter-item "><a href="../../tutorial/counter-app/multiple-files.html"><strong aria-hidden="true">2.2.3.</strong> Multiple Files</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorial/counter-app/app.html"><strong aria-hidden="true">2.2.3.1.</strong> app.rs</a></li><li class="chapter-item "><a href="../../tutorial/counter-app/ui.html"><strong aria-hidden="true">2.2.3.2.</strong> ui.rs</a></li><li class="chapter-item "><a href="../../tutorial/counter-app/event.html"><strong aria-hidden="true">2.2.3.3.</strong> event.rs</a></li><li class="chapter-item "><a href="../../tutorial/counter-app/tui.html"><strong aria-hidden="true">2.2.3.4.</strong> tui.rs</a></li><li class="chapter-item "><a href="../../tutorial/counter-app/update.html"><strong aria-hidden="true">2.2.3.5.</strong> update.rs</a></li><li class="chapter-item "><a href="../../tutorial/counter-app/main.html"><strong aria-hidden="true">2.2.3.6.</strong> main.rs</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../tutorial/json-editor/index.html"><strong aria-hidden="true">2.3.</strong> JSON Editor</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorial/json-editor/app.html"><strong aria-hidden="true">2.3.1.</strong> App.rs - Holding application state</a></li><li class="chapter-item "><a href="../../tutorial/json-editor/main.html"><strong aria-hidden="true">2.3.2.</strong> Main.rs - UI loop and event handling</a></li><li class="chapter-item "><a href="../../tutorial/json-editor/ui.html"><strong aria-hidden="true">2.3.3.</strong> Ui.rs - Layouts, widgets, frames, oh my!</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorial/json-editor/ui-main.html"><strong aria-hidden="true">2.3.3.1.</strong> Ui.rs - Main</a></li><li class="chapter-item "><a href="../../tutorial/json-editor/ui-editing.html"><strong aria-hidden="true">2.3.3.2.</strong> Ui.rs - Editing</a></li><li class="chapter-item "><a href="../../tutorial/json-editor/ui-exit.html"><strong aria-hidden="true">2.3.3.3.</strong> Ui.rs - Exit</a></li></ol></li><li class="chapter-item "><a href="../../tutorial/json-editor/closing_thoughts.html"><strong aria-hidden="true">2.3.4.</strong> Conclusion</a></li></ol></li><li class="chapter-item "><a href="../../tutorial/counter-async-app/index.html"><strong aria-hidden="true">2.4.</strong> Async Counter App</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../tutorial/counter-async-app/actions.html"><strong aria-hidden="true">2.4.1.</strong> Actions</a></li><li class="chapter-item "><a href="../../tutorial/counter-async-app/sync-increment-decrement.html"><strong aria-hidden="true">2.4.2.</strong> Sync Increment & Decrement</a></li><li class="chapter-item "><a href="../../tutorial/counter-async-app/async-increment-decrement.html"><strong aria-hidden="true">2.4.3.</strong> Async Increment & Decrement</a></li><li class="chapter-item "><a href="../../tutorial/counter-async-app/async-event-stream.html"><strong aria-hidden="true">2.4.4.</strong> Async Event Stream</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../concepts/index.html"><strong aria-hidden="true">3.</strong> Concepts</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../concepts/rendering.html"><strong aria-hidden="true">3.1.</strong> Rendering</a></li><li class="chapter-item "><a href="../../concepts/event_handling.html"><strong aria-hidden="true">3.2.</strong> Event Handling</a></li><li class="chapter-item "><a href="../../concepts/the-elm-architecture.html"><strong aria-hidden="true">3.3.</strong> The Elm Architecture</a></li><li class="chapter-item "><a href="../../concepts/component-architecture.html"><strong aria-hidden="true">3.4.</strong> Component Architecture</a></li><li class="chapter-item "><a href="../../concepts/flux-architecture.html"><strong aria-hidden="true">3.5.</strong> Flux Architecture</a></li><li class="chapter-item "><div><strong aria-hidden="true">3.6.</strong> Project Structure</div></li><li class="chapter-item "><div><strong aria-hidden="true">3.7.</strong> Application Patterns</div></li><li class="chapter-item "><div><strong aria-hidden="true">3.8.</strong> Design Patterns</div></li><li class="chapter-item "><div><strong aria-hidden="true">3.9.</strong> Application State</div></li><li class="chapter-item "><div><strong aria-hidden="true">3.10.</strong> Event Handling</div></li><li class="chapter-item "><div><strong aria-hidden="true">3.11.</strong> Key Binding</div></li><li class="chapter-item "><div><strong aria-hidden="true">3.12.</strong> Threading</div></li><li class="chapter-item "><div><strong aria-hidden="true">3.13.</strong> Logging</div></li><li class="chapter-item "><div><strong aria-hidden="true">3.14.</strong> Configuration</div></li></ol></li><li class="chapter-item expanded "><a href="../../integrations/index.html"><strong aria-hidden="true">4.</strong> Integrations</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> How To</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../how-to/features.html"><strong aria-hidden="true">5.1.</strong> Enable Features</a></li><li class="chapter-item "><a href="../../how-to/choose-a-backend.html"><strong aria-hidden="true">5.2.</strong> Choose a Backend</a></li><li class="chapter-item "><a href="../../how-to/setup-panic-hooks.html"><strong aria-hidden="true">5.3.</strong> Setup Panic Hooks</a></li><li class="chapter-item "><a href="../../how-to/setup-panic-hooks-better-panic.html"><strong aria-hidden="true">5.4.</strong> Setup Panic Hooks with better-panic</a></li><li class="chapter-item "><a href="../../how-to/setup-logging-tracing.html"><strong aria-hidden="true">5.5.</strong> Setup Logging with tracing</a></li><li class="chapter-item "><a href="../../how-to/handle-xdg-directories.html"><strong aria-hidden="true">5.6.</strong> Handle XDG Directories</a></li><li class="chapter-item "><a href="../../how-to/clap.html"><strong aria-hidden="true">5.7.</strong> Handle CLI arguments</a></li><li class="chapter-item "><a href="../../how-to/center-a-rect.html"><strong aria-hidden="true">5.8.</strong> Center a Rect</a></li><li class="chapter-item "><a href="../../how-to/combine-terminal-and-eventhandler.html"><strong aria-hidden="true">5.9.</strong> Combine Terminal and EventHandler</a></li><li class="chapter-item "><div><strong aria-hidden="true">5.10.</strong> Blocks</div></li><li class="chapter-item "><div><strong aria-hidden="true">5.11.</strong> Displaying Text</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div><strong aria-hidden="true">5.11.1.</strong> Styling-Text</div></li><li class="chapter-item "><div><strong aria-hidden="true">5.11.2.</strong> Paragraphs</div></li></ol></li><li class="chapter-item "><a href="../../how-to/layout-constraints-basics.html"><strong aria-hidden="true">5.12.</strong> Layouts Constraints Basics</a></li><li class="chapter-item "><div><strong aria-hidden="true">5.13.</strong> Layout Widgets</div></li><li class="chapter-item "><div><strong aria-hidden="true">5.14.</strong> Create a Widget</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> FAQ</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../faq/duplicate-key-events-windows.html"><strong aria-hidden="true">6.1.</strong> Duplicate key events on Windows</a></li><li class="chapter-item "><a href="../../faq/tokio-async.html"><strong aria-hidden="true">6.2.</strong> tokio / async</a></li><li class="chapter-item "><a href="../../faq/tui-rs-history.html"><strong aria-hidden="true">6.3.</strong> tui.rs history</a></li></ol></li><li class="chapter-item expanded "><a href="../../references/index.html"><strong aria-hidden="true">7.</strong> References</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> Developer Guide</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../developer-guide/ratatui.html"><strong aria-hidden="true">8.1.</strong> Ratatui</a></li><li class="chapter-item "><a href="../../developer-guide/book.html"><strong aria-hidden="true">8.2.</strong> Ratatui Book</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../../contributors.html">Contributors</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="latte">Latte</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="frappe">Frappé</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="macchiato">Macchiato</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mocha">Mocha</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Ratatui Book</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/ratatui-org/ratatui-book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/ratatui-org/ratatui-book/edit/main/src/tutorial/counter-app/refactor.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="refactor"><a class="header" href="#refactor">Refactor</a></h1>
<p>In this section, we will walk through the process of refactoring the application to set ourselves up
better for bigger projects. Not all of these changes are <code>ratatui</code> specific, and are generally good
coding practices to follow.</p>
<h2 id="organizing-imports"><a class="header" href="#organizing-imports">Organizing imports</a></h2>
<p>The first thing you might consider doing is reorganizing imports with qualified names.</p>
<pre><code class="language-rust">use crossterm::{
  event::{self, Event::Key, KeyCode::Char},
  execute,
  terminal::{disable_raw_mode, enable_raw_mode, EnterAlternateScreen, LeaveAlternateScreen},
};
use ratatui::{
  prelude::{CrosstermBackend, Terminal},
  widgets::Paragraph,
};</code></pre>
<h2 id="typedefs-and-type-aliases"><a class="header" href="#typedefs-and-type-aliases">Typedefs and Type Aliases</a></h2>
<p>By defining custom types and aliases, we can simplify our code and make it more expressive.</p>
<pre><code class="language-rust">type Err = Box&lt;dyn std::error::Error&gt;;
type Result&lt;T&gt; = std::result::Result&lt;T, Err&gt;;
pub type Frame&lt;'a&gt; = ratatui::Frame&lt;'a, CrosstermBackend&lt;std::io::Stderr&gt;&gt;;</code></pre>
<div id="admonition-tip" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="#admonition-tip"></a></p>
</div>
<div>
<p>If you use the popular <a href="https://docs.rs/anyhow/latest/anyhow/"><code>anyhow</code></a> crate,
then instead of these two lines:</p>
<pre><code class="language-rust">type Err = Box&lt;dyn std::error::Error&gt;;
type Result&lt;T&gt; = std::result::Result&lt;T, Err&gt;;</code></pre>
<p>you can simply import <code>anyhow::Result</code>:</p>
<pre><code class="language-rust">use anyhow::Result;</code></pre>
<p>You will need to run <code>cargo add anyhow</code> for this to work.</p>
</div>
</div>
<p><code>Frame</code> is a shorthand type to represent the frame we draw to when we render our application.</p>
<h2 id="app-struct"><a class="header" href="#app-struct"><code>App</code> struct</a></h2>
<p>By defining an <code>App</code> struct, we can encapsulate our application state and make it more structured.</p>
<pre><code class="language-rust">struct App {
  counter: i64,
  should_quit: bool,
}</code></pre>
<ul>
<li><code>counter</code> holds the current value of our counter.</li>
<li><code>should_quit</code> is a flag that indicates whether the application should exit its main loop.</li>
</ul>
<h2 id="breaking-up-main"><a class="header" href="#breaking-up-main">Breaking up <code>main()</code></a></h2>
<p>We can extract significant parts of the <code>main()</code> function into separate smaller functions, e.g.
<code>startup()</code>, <code>shutdown()</code>, <code>ui()</code>, <code>update()</code>, <code>run()</code>.</p>
<p><code>startup()</code> is responsible for initializing the terminal.</p>
<pre><code class="language-rust">fn startup() -&gt; Result&lt;()&gt; {
  enable_raw_mode()?;
  execute!(std::io::stderr(), EnterAlternateScreen)?;
  Ok(())
}</code></pre>
<p><code>shutdown()</code> cleans up the terminal.</p>
<pre><code class="language-rust">fn shutdown() -&gt; Result&lt;()&gt; {
  execute!(std::io::stderr(), LeaveAlternateScreen)?;
  disable_raw_mode()?;
  Ok(())
}</code></pre>
<p><code>ui()</code> handles rendering of our application state.</p>
<pre><code class="language-rust">fn ui(f: &amp;mut Frame&lt;'_&gt;, app: &amp;App) {
  f.render_widget(Paragraph::new(format!(&quot;Counter: {}&quot;, app.counter)), f.size());
}</code></pre>
<p><code>update()</code> processes user input and updates our application state.</p>
<pre><code class="language-rust">fn update(app: &amp;mut App) -&gt; Result&lt;()&gt; {
  if event::poll(std::time::Duration::from_millis(250))? {
    if let Key(key) = event::read()? {
      match key.code {
        Char('j') =&gt; app.counter += 1,
        Char('k') =&gt; app.counter -= 1,
        Char('q') =&gt; app.should_quit = true,
        _ =&gt; (),
      }
    }
  }
  Ok(())
}</code></pre>
<p>You’ll notice that in the <code>update()</code> function we make use of pattern matching for handling user
input. This is a powerful feature in rust; and enhances readability and provides a clear pattern for
how each input is processed.</p>
<p><code>run()</code> contains our main application loop.</p>
<pre><code class="language-rust">fn run() -&gt; Result&lt;()&gt; {
  // ratatui terminal
  let mut t = Terminal::new(CrosstermBackend::new(std::io::stderr()))?;

  // application state
  let mut app = App { counter: 0, should_quit: false };

  loop {
    // application render
    t.draw(|f| {
      ui(f, &amp;app);
    })?;

    // application update
    update(&amp;mut app)?;

    // application exit
    if app.should_quit {
      break;
    }
  }

  Ok(())
}</code></pre>
<p>Each function now has a specific task, making our main application logic more organized and easier
to follow.</p>
<pre><code class="language-rust">fn main() -&gt; Result&lt;()&gt; {
  startup()?;
  let status = run();
  shutdown()?;
  status?;
  Ok(())
}</code></pre>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="#admonition-note"></a></p>
</div>
<div>
<p>You may be wondering if we could have written the <code>main</code> function like so:</p>
<pre><code class="language-rust">fn main() -&gt; Result&lt;()&gt; {
  startup()?;
  run()?;
  shutdown()?;
  Ok(())
}</code></pre>
<p>This works fine during the happy path of a program.</p>
<p>However, if your <code>run()</code> function returns an error, the program will not call <code>shutdown()</code>.
And this can leave your terminal in a messed up
state for your users.</p>
<p>Instead, we should ensure that <code>shutdown()</code> is <em>always</em> called before the program exits.</p>
<pre><code class="language-rust">fn main() -&gt; Result&lt;()&gt; {
  startup()?;
  let result = run();
  shutdown()?;
  result?;
  Ok(())
}</code></pre>
<p>Here, we can get the result of <code>run()</code>, and call <code>shutdown()</code> first and then <code>unwrap()</code> on the result.
This will be a much better experience for users.</p>
<p>We will discuss in future sections how to handle the situation when your code unexpectedly panics.</p>
</div>
</div>
<h2 id="conclusion"><a class="header" href="#conclusion">Conclusion</a></h2>
<p>By making our code more organized, modular, and readable, we not only make it easier for others to
understand and work with but also set the stage for future enhancements and extensions.</p>
<p>Here’s the full code for reference:</p>
<pre><code class="language-rust">use anyhow::Result;
use crossterm::{
  event::{self, Event::Key, KeyCode::Char},
  execute,
  terminal::{disable_raw_mode, enable_raw_mode, EnterAlternateScreen, LeaveAlternateScreen},
};
use ratatui::{
  prelude::{CrosstermBackend, Terminal},
  widgets::Paragraph,
};

pub type Frame&lt;'a&gt; = ratatui::Frame&lt;'a, CrosstermBackend&lt;std::io::Stderr&gt;&gt;;

fn startup() -&gt; Result&lt;()&gt; {
  enable_raw_mode()?;
  execute!(std::io::stderr(), EnterAlternateScreen)?;
  Ok(())
}

fn shutdown() -&gt; Result&lt;()&gt; {
  execute!(std::io::stderr(), LeaveAlternateScreen)?;
  disable_raw_mode()?;
  Ok(())
}

// App state
struct App {
  counter: i64,
  should_quit: bool,
}

// App ui render function
fn ui(f: &amp;mut Frame&lt;'_&gt;, app: &amp;App) {
  f.render_widget(Paragraph::new(format!(&quot;Counter: {}&quot;, app.counter)), f.size());
}

// App update function
fn update(app: &amp;mut App) -&gt; Result&lt;()&gt; {
  if event::poll(std::time::Duration::from_millis(250))? {
    if let Key(key) = event::read()? {
      match key.code {
        Char('j') =&gt; app.counter += 1,
        Char('k') =&gt; app.counter -= 1,
        Char('q') =&gt; app.should_quit = true,
        _ =&gt; (),
      }
    }
  }
  Ok(())
}

fn run() -&gt; Result&lt;()&gt; {
  // ratatui terminal
  let mut t = Terminal::new(CrosstermBackend::new(std::io::stderr()))?;

  // application state
  let mut app = App { counter: 0, should_quit: false };

  loop {
    // application update
    update(&amp;mut app)?;

    // application render
    t.draw(|f| {
      ui(f, &amp;app);
    })?;

    // application exit
    if app.should_quit {
      break;
    }
  }

  Ok(())
}

fn main() -&gt; Result&lt;()&gt; {
  // setup terminal
  startup()?;

  let result = run();

  // teardown terminal before unwrapping Result of app run
  shutdown()?;

  result?;

  Ok(())
}</code></pre>
<p>Here’s a flow chart representation of the various steps in the program:</p>
<pre class="mermaid">graph TD
    MainRun[Main: Run];
    CheckEvent[Main: Poll KeyPress];
    UpdateApp[Main: Update App];
    ShouldQuit[Main: Check should_quit?];
    BreakLoop[Main: Break Loop];
    MainStart[Main: Start];
    MainEnd[Main: End];
    MainStart --&gt; MainRun;
    MainRun --&gt; CheckEvent;
    CheckEvent --&gt;|No KeyPress| Draw;
    CheckEvent --&gt; |KeyPress Received| UpdateApp;
    Draw --&gt; ShouldQuit;
    UpdateApp --&gt; Draw;
    ShouldQuit --&gt;|Yes| BreakLoop;
    BreakLoop --&gt; MainEnd;
    ShouldQuit --&gt;|No| CheckEvent;
</pre>
<div id="admonition-question" class="admonition question">
<div class="admonition-title">
<p>Question</p>
<p><a class="admonition-anchor-link" href="#admonition-question"></a></p>
</div>
<div>
<p>What do you think happens if you modify the example above to change the polling to <code>0</code> milliseconds?</p>
<p>What would happen if you change the example to poll every 10 seconds?</p>
<p>Experiment with different “tick rates” and see how that affects the user experience.
Also, monitor your CPU usage when you do this experiment.</p>
</div>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../tutorial/counter-app/single-function.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../tutorial/counter-app/multiple-files.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../tutorial/counter-app/single-function.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../tutorial/counter-app/multiple-files.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
